{"name":"Update supplier stock (Quantore)","description":null,"organizationId":43565,"isEnabled":false,"crontab":null,"timezone":"Europe/Lisbon","blockData":[{"top":-1648,"left":-1968,"uuid":"6b7d7163-2f02-4f94-bcac-29d49eb4e733","options":{},"pluginId":"startTrigger","blockType":"webhook","editorType":"JavascriptQuery","environment":"production","isMinimized":false,"resourceName":"webhook","incomingOnSuccessEdges":[]},{"top":-1648,"left":1824,"uuid":"5e934ebc-2e8f-48a2-88db-8e41cd96b2e9","pluginId":"update_workflow_runs","blockType":"default","editorType":"SqlQueryUnified","environment":"production","resourceName":"01ebedd9-f35e-425f-9c3f-5429f9cfa4fe","incomingOnSuccessEdges":["8a0fe9f8-18cc-4392-8614-d3c38d9e067d"]},{"top":-1280,"left":1824,"uuid":"19cfcfd3-e74a-42ef-965f-987d11aea788","pluginId":"update_workflow_runs2","blockType":"default","editorType":"SqlQueryUnified","environment":"production","resourceName":"01ebedd9-f35e-425f-9c3f-5429f9cfa4fe","incomingOnSuccessEdges":["05fbe898-3171-4633-8ea2-5d3bdeac8945"]},{"top":-1648,"left":-1504,"uuid":"ae1d9cfc-8d54-4791-a4b1-b2ac938e3140","pluginId":"workflow_data","blockType":"default","editorType":"SqlQueryUnified","environment":"production","resourceName":"01ebedd9-f35e-425f-9c3f-5429f9cfa4fe","incomingOnSuccessEdges":["6b7d7163-2f02-4f94-bcac-29d49eb4e733"]},{"top":-1648,"left":1376,"uuid":"8a0fe9f8-18cc-4392-8614-d3c38d9e067d","pluginId":"code1","blockType":"code","editorType":"JavascriptQuery","environment":"production","resourceName":"JavascriptQuery","incomingPorts":[{"portId":"9f585afa-0747-4aa3-b5e2-badc9c387e64","blockId":"ecbc4d70-8fe0-474d-84fc-6fd0845f3563"}],"incomingOnSuccessEdges":["32f579ac-64f4-46c5-971d-8bc60e98bfa7"]},{"top":-1280,"left":1376,"uuid":"05fbe898-3171-4633-8ea2-5d3bdeac8945","pluginId":"code2","blockType":"code","editorType":"JavascriptQuery","environment":"production","resourceName":"JavascriptQuery","incomingPorts":[],"failureCondition":"true","incomingOnSuccessEdges":[]},{"top":-2048,"left":-784,"uuid":"eedb48a5-bb6b-462a-ba28-db70a132460d","pluginId":"get_optiply_data","blockType":"default","dimensions":{"width":416,"height":512},"editorType":"SqlQueryUnified","environment":"production","retryPolicy":{"numAttempts":4,"initialIntervalMs":1000},"resourceName":"Optiply_ProductionDB","incomingOnSuccessEdges":["ae1d9cfc-8d54-4791-a4b1-b2ac938e3140"]},{"top":-1648,"left":-80,"uuid":"b56624d9-447e-4c09-be92-3f962e2cb67c","pluginId":"map_suppliers","blockType":"code","dimensions":{"width":384,"height":416},"editorType":"JavascriptQuery","environment":"production","resourceName":"JavascriptQuery","incomingOnSuccessEdges":["eedb48a5-bb6b-462a-ba28-db70a132460d","acca4ef5-6eae-4245-87f6-efe7710361cb","f0fc0b88-f14a-40f7-99ef-7a1399fe6105"]},{"top":-1648,"left":416,"uuid":"ecbc4d70-8fe0-474d-84fc-6fd0845f3563","options":{"conditions":[{"id":"c305c709-05b0-4cb5-a89d-f65c2c5c6e0e","type":"if","statement":"map_suppliers.data != 0","outgoingPortId":"d3902bb4-169b-4d83-a64c-e4d2a5f0e8b7"},{"id":"85f10baa-ff5e-421a-b251-578879cd5d4c","type":"else","statement":"","outgoingPortId":"9f585afa-0747-4aa3-b5e2-badc9c387e64"}]},"pluginId":"patch_check","blockType":"conditional","editorType":"JavascriptQuery","onboarding":false,"environment":"production","isMinimized":false,"resourceName":"JavascriptQuery","incomingPorts":[],"outgoingPorts":[{"id":"d3902bb4-169b-4d83-a64c-e4d2a5f0e8b7","name":"0","type":"conditional"},{"id":"9f585afa-0747-4aa3-b5e2-badc9c387e64","name":"1","type":"conditional"}],"incomingOnSuccessEdges":["b56624d9-447e-4c09-be92-3f962e2cb67c"]},{"top":-1088,"left":-816,"uuid":"acca4ef5-6eae-4245-87f6-efe7710361cb","pluginId":"craft_ftp","blockType":"code","dimensions":{"width":544,"height":640},"editorType":"PythonQuery","environment":"production","retryPolicy":{"numAttempts":4,"initialIntervalMs":1000},"resourceName":"PythonQuery","incomingOnSuccessEdges":["ae1d9cfc-8d54-4791-a4b1-b2ac938e3140"]},{"top":64,"left":-832,"uuid":"f0fc0b88-f14a-40f7-99ef-7a1399fe6105","pluginId":"craft_price","blockType":"code","dimensions":{"width":544,"height":640},"editorType":"PythonQuery","environment":"production","retryPolicy":{"numAttempts":4,"initialIntervalMs":1000},"resourceName":"PythonQuery","incomingOnSuccessEdges":["ae1d9cfc-8d54-4791-a4b1-b2ac938e3140"]},{"top":-1344,"left":544,"uuid":"32f579ac-64f4-46c5-971d-8bc60e98bfa7","pluginId":"write_cost_and_stock","blockType":"default","dimensions":{"width":576,"height":480},"editorType":"SqlQueryUnified","environment":"production","resourceName":"Optiply_ProductionDB","incomingPorts":[{"portId":"d3902bb4-169b-4d83-a64c-e4d2a5f0e8b7","blockId":"ecbc4d70-8fe0-474d-84fc-6fd0845f3563"}],"incomingOnSuccessEdges":[]}],"templateData":"[\"~#iR\",[\"^ \",\"n\",\"appTemplate\",\"v\",[\"^ \",\"appMaxWidth\",\"100%\",\"appStyles\",\"\",\"appTesting\",null,\"appThemeId\",null,\"appThemeModeId\",null,\"appThemeName\",null,\"createdAt\",null,\"customComponentCollections\",[],\"customDocumentTitle\",\"\",\"customDocumentTitleEnabled\",false,\"customShortcuts\",[],\"experimentalFeatures\",[\"^ \",\"disableMultiplayerEditing\",false,\"multiplayerEditingEnabled\",false,\"sourceControlTemplateDehydration\",false],\"folders\",[\"~#iL\",[]],\"formAppSettings\",[\"^ \",\"customRedirectUrl\",\"\"],\"inAppRetoolPillAppearance\",\"NO_OVERRIDE\",\"instrumentationEnabled\",false,\"internationalizationSettings\",[\"^ \",\"internationalizationEnabled\",false,\"internationalizationFiles\",[]],\"isFetching\",false,\"isFormApp\",false,\"isGlobalWidget\",false,\"isMobileApp\",false,\"loadingIndicatorsDisabled\",false,\"markdownLinkBehavior\",\"auto\",\"mobileAppSettings\",[\"^ \",\"displaySetting\",[\"^ \",\"landscapeMode\",false,\"tabletMode\",false],\"mobileOfflineModeBannerMode\",\"default\",\"mobileOfflineModeDelaySync\",false,\"mobileOfflineModeEnabled\",false],\"mobileOfflineAssets\",[],\"multiScreenMobileApp\",false,\"notificationsSettings\",[\"^ \",\"globalQueryShowFailureToast\",true,\"globalQueryShowSuccessToast\",false,\"globalQueryToastDuration\",4.5,\"globalToastPosition\",\"bottomRight\"],\"pageCodeFolders\",[\"^ \"],\"pageLoadValueOverrides\",[\"^A\",[]],\"persistUrlParams\",false,\"plugins\",[\"~#iOM\",[\"startTrigger\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"startTrigger\",\"uuid\",null,\"_comment\",null,\"type\",\"datasource\",\"subtype\",\"JavascriptQuery\",\"namespace\",null,\"resourceName\",\"JavascriptQuery\",\"resourceDisplayName\",null,\"template\",[\"~#iM\",[\"queryRefreshTime\",\"\",\"allowedGroupIds\",[\"^A\",[]],\"streamResponse\",false,\"lastReceivedFromResourceAt\",null,\"isFunction\",false,\"functionParameters\",null,\"queryDisabledMessage\",\"\",\"servedFromCache\",false,\"offlineUserQueryInputs\",\"\",\"functionDescription\",null,\"successMessage\",\"\",\"queryDisabled\",\"\",\"playgroundQuerySaveId\",\"latest\",\"workflowParams\",null,\"resourceNameOverride\",\"\",\"runWhenModelUpdates\",false,\"workflowRunExecutionType\",\"sync\",\"showFailureToaster\",true,\"query\",\"\\n  const evalStartTriggerBlock = () => {\\n    const getExampleInputJSON = () => {\\n      try {\\n        return {\\n  \\\"webshopHandle\\\": 'alleeninkt',\\n  \\\"webshopId\\\": 1346,\\n  \\\"webshopUuid\\\": 'ec100d9c-c24d-432b-8393-251cbeb2633f'\\n}\\n      } catch {\\n        return { error: true, message: 'Error parsing example input JSON' }\\n      }\\n    }\\n    const getExamplePathParams = () => {\\n      try {\\n        return {}\\n      } catch {\\n        return { error: true, message: 'Error parsing example path params' }\\n      }\\n    }\\n    const getExampleHeaders = () => {\\n      try {\\n        return {}\\n      } catch {\\n        return { error: true, message: 'Error parsing example headers' }\\n      }\\n    }\\n    return {\\n      _retool_exampleInputJSON: getExampleInputJSON(),\\n      _retool_exampleHeaders: getExampleHeaders(),\\n      _retool_examplePathParams: getExamplePathParams(),\\n    }\\n  }\\n  return evalStartTriggerBlock()\\n  \",\"playgroundQueryUuid\",\"\",\"playgroundQueryId\",null,\"error\",null,\"workflowRunBodyType\",\"raw\",\"privateParams\",[\"^A\",[]],\"queryRunOnSelectorUpdate\",false,\"runWhenPageLoadsDelay\",\"\",\"data\",null,\"importedQueryInputs\",[\"^1>\",[]],\"_additionalScope\",[\"^A\",[]],\"isImported\",false,\"showSuccessToaster\",true,\"cacheKeyTtl\",\"\",\"requestSentTimestamp\",null,\"metadata\",null,\"queryRunTime\",null,\"changesetObject\",\"\",\"offlineOptimisticResponse\",null,\"errorTransformer\",\"return data.error\",\"finished\",null,\"confirmationMessage\",null,\"isFetching\",false,\"changeset\",\"\",\"rawData\",null,\"queryTriggerDelay\",\"0\",\"resourceTypeOverride\",null,\"watchedParams\",[\"^A\",[]],\"enableErrorTransformer\",false,\"showLatestVersionUpdatedWarning\",false,\"timestamp\",0,\"evalType\",\"script\",\"importedQueryDefaults\",[\"^1>\",[]],\"enableTransformer\",false,\"showUpdateSetValueDynamicallyToggle\",true,\"overrideOrgCacheForUserCache\",false,\"runWhenPageLoads\",false,\"transformer\",\"return data\",\"events\",[\"^A\",[]],\"queryTimeout\",\"10000\",\"workflowId\",null,\"requireConfirmation\",false,\"queryFailureConditions\",\"\",\"changesetIsObject\",false,\"enableCaching\",false,\"allowedGroups\",[\"^A\",[]],\"offlineQueryType\",\"None\",\"queryThrottleTime\",\"750\",\"updateSetValueDynamically\",false,\"notificationDuration\",\"\"]],\"style\",[\"^1>\",[]],\"position2\",null,\"mobilePosition2\",null,\"mobileAppPosition\",null,\"tabIndex\",null,\"container\",\"\",\"^7\",\"~m1745914398014\",\"updatedAt\",\"~m1769581615221\",\"folder\",\"\",\"presetName\",null,\"screen\",null,\"boxId\",null,\"subBoxIds\",null]]],\"update_workflow_runs\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"update_workflow_runs\",\"^16\",null,\"^17\",null,\"^18\",\"datasource\",\"^19\",\"SqlQueryUnified\",\"^1:\",null,\"^1;\",\"01ebedd9-f35e-425f-9c3f-5429f9cfa4fe\",\"^1<\",\"retool_db\",\"^1=\",[\"^1>\",[\"queryRefreshTime\",\"\",\"allowedGroupIds\",[\"^A\",[]],\"streamResponse\",false,\"records\",\"\",\"lastReceivedFromResourceAt\",null,\"isFunction\",false,\"databasePasswordOverride\",\"\",\"functionParameters\",null,\"queryDisabledMessage\",\"\",\"servedFromCache\",false,\"offlineUserQueryInputs\",\"\",\"functionDescription\",null,\"successMessage\",\"\",\"queryDisabled\",\"\",\"playgroundQuerySaveId\",\"latest\",\"workflowParams\",null,\"resourceNameOverride\",\"\",\"runWhenModelUpdates\",false,\"workflowRunExecutionType\",\"sync\",\"showFailureToaster\",true,\"query\",\"INSERT INTO workflow_runs (\\n  started_at,\\n  ended_at,\\n  current_run,\\n  workflow_description,\\n  workflow_id,\\n  workflow_name,\\n  workflow_status,\\n  webshop_uuid,\\n  webshop_handle\\n)\\nVALUES (\\n  {{ code1.data.body.startedAt ? `'${code1.data.body.startedAt}'` : 'NULL' }},\\n  {{ code1.data.body.endedAt ? `'${code1.data.body.endedAt}'` : 'NULL' }},\\n  '{{ JSON.stringify(code1.data.body.workflowContext.currentRun)?.replace(/'/g, \\\"''\\\") }}',\\n  '{{ code1.data.body.workflowDescription ? code1.data.body.workflowDescription.replace(/'/g, \\\"''\\\") : '' }}',\\n  '{{ code1.data.body.workflowContext.workflowId }}',\\n  '{{ code1.data.body.workflowContext.name ? code1.data.body.workflowContext.name.replace(/'/g, \\\"''\\\") : '' }}',\\n  '{{ code1.data.body.workflowStatus }}',\\n  '{{ code1.data.body.webshopUuid }}',\\n  '{{ code1.data.body.webshopHandle }}'\\n);\",\"playgroundQueryUuid\",\"\",\"playgroundQueryId\",null,\"error\",null,\"workflowRunBodyType\",\"raw\",\"privateParams\",[\"^A\",[]],\"queryRunOnSelectorUpdate\",false,\"runWhenPageLoadsDelay\",\"\",\"warningCodes\",[\"^A\",[]],\"data\",null,\"recordId\",\"\",\"importedQueryInputs\",[\"^1>\",[]],\"_additionalScope\",[\"^A\",[]],\"isImported\",false,\"showSuccessToaster\",true,\"dataArray\",[\"^A\",[]],\"cacheKeyTtl\",\"\",\"filterBy\",\"\",\"requestSentTimestamp\",null,\"databaseHostOverride\",\"\",\"metadata\",null,\"editorMode\",\"sql\",\"queryRunTime\",null,\"actionType\",\"\",\"changesetObject\",\"\",\"shouldUseLegacySql\",false,\"offlineOptimisticResponse\",null,\"errorTransformer\",\"return data.error\",\"finished\",null,\"databaseNameOverride\",\"\",\"confirmationMessage\",null,\"isFetching\",false,\"changeset\",\"\",\"rawData\",null,\"queryTriggerDelay\",\"0\",\"resourceTypeOverride\",null,\"watchedParams\",[\"^A\",[]],\"enableErrorTransformer\",false,\"databaseWarehouseOverride\",\"\",\"enableBulkUpdates\",false,\"showLatestVersionUpdatedWarning\",false,\"timestamp\",0,\"evalType\",\"script\",\"importedQueryDefaults\",[\"^1>\",[]],\"enableTransformer\",false,\"showUpdateSetValueDynamicallyToggle\",true,\"overrideOrgCacheForUserCache\",false,\"bulkUpdatePrimaryKey\",\"\",\"runWhenPageLoads\",false,\"transformer\",\"return data\",\"events\",[\"^A\",[]],\"tableName\",\"\",\"queryTimeout\",\"120000\",\"workflowId\",null,\"requireConfirmation\",false,\"queryFailureConditions\",\"\",\"changesetIsObject\",false,\"enableCaching\",false,\"allowedGroups\",[\"^A\",[]],\"databaseUsernameOverride\",\"\",\"databaseRoleOverride\",\"\",\"shouldEnableBatchQuerying\",false,\"doNotThrowOnNoOp\",false,\"offlineQueryType\",\"None\",\"queryThrottleTime\",\"750\",\"updateSetValueDynamically\",false,\"notificationDuration\",\"\"]],\"^1?\",[\"^1>\",[]],\"^1@\",null,\"^1A\",null,\"^1B\",null,\"^1C\",null,\"^1D\",\"\",\"^7\",\"~m1745941743466\",\"^1E\",\"~m1748966037969\",\"^1F\",\"\",\"^1G\",null,\"^1H\",null,\"^1I\",null,\"^1J\",null]]],\"update_workflow_runs2\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"update_workflow_runs2\",\"^16\",null,\"^17\",null,\"^18\",\"datasource\",\"^19\",\"SqlQueryUnified\",\"^1:\",null,\"^1;\",\"01ebedd9-f35e-425f-9c3f-5429f9cfa4fe\",\"^1<\",\"retool_db\",\"^1=\",[\"^1>\",[\"queryRefreshTime\",\"\",\"allowedGroupIds\",[\"^A\",[]],\"streamResponse\",false,\"records\",\"\",\"lastReceivedFromResourceAt\",null,\"isFunction\",false,\"databasePasswordOverride\",\"\",\"functionParameters\",null,\"queryDisabledMessage\",\"\",\"servedFromCache\",false,\"offlineUserQueryInputs\",\"\",\"functionDescription\",null,\"successMessage\",\"\",\"queryDisabled\",\"\",\"playgroundQuerySaveId\",\"latest\",\"workflowParams\",null,\"resourceNameOverride\",\"\",\"runWhenModelUpdates\",false,\"workflowRunExecutionType\",\"sync\",\"showFailureToaster\",true,\"query\",\"INSERT INTO workflow_runs (\\n  started_at,\\n  ended_at,\\n  current_run,\\n  workflow_description,\\n  workflow_id,\\n  workflow_name,\\n  workflow_status,\\n  webshop_uuid,\\n  webshop_handle\\n)\\nVALUES (\\n  {{ code2.data.body.startedAt ? `'${code2.data.body.startedAt}'` : 'NULL' }},\\n  {{ code2.data.body.endedAt ? `'${code2.data.body.endedAt}'` : 'NULL' }},\\n  '{{ JSON.stringify(code2.data.body.workflowContext.currentRun)?.replace(/'/g, \\\"''\\\") }}',\\n  '{{ code2.data.body.workflowDescription ? code2.data.body.workflowDescription.replace(/'/g, \\\"''\\\") : '' }}',\\n  '{{ code2.data.body.workflowContext.workflowId }}',\\n  '{{ code2.data.body.workflowContext.name ? code2.data.body.workflowContext.name.replace(/'/g, \\\"''\\\") : '' }}',\\n  '{{ code2.data.body.workflowStatus }}',\\n  '{{ code2.data.body.webshopUuid }}',\\n  '{{ code2.data.body.webshopHandle }}'\\n);\",\"playgroundQueryUuid\",\"\",\"playgroundQueryId\",null,\"error\",null,\"workflowRunBodyType\",\"raw\",\"privateParams\",[\"^A\",[]],\"queryRunOnSelectorUpdate\",false,\"runWhenPageLoadsDelay\",\"\",\"warningCodes\",[\"^A\",[]],\"data\",null,\"recordId\",\"\",\"importedQueryInputs\",[\"^1>\",[]],\"_additionalScope\",[\"^A\",[]],\"isImported\",false,\"showSuccessToaster\",true,\"dataArray\",[\"^A\",[]],\"cacheKeyTtl\",\"\",\"filterBy\",\"\",\"requestSentTimestamp\",null,\"databaseHostOverride\",\"\",\"metadata\",null,\"editorMode\",\"sql\",\"queryRunTime\",null,\"actionType\",\"\",\"changesetObject\",\"\",\"shouldUseLegacySql\",false,\"offlineOptimisticResponse\",null,\"errorTransformer\",\"return data.error\",\"finished\",null,\"databaseNameOverride\",\"\",\"confirmationMessage\",null,\"isFetching\",false,\"changeset\",\"\",\"rawData\",null,\"queryTriggerDelay\",\"0\",\"resourceTypeOverride\",null,\"watchedParams\",[\"^A\",[]],\"enableErrorTransformer\",false,\"databaseWarehouseOverride\",\"\",\"enableBulkUpdates\",false,\"showLatestVersionUpdatedWarning\",false,\"timestamp\",0,\"evalType\",\"script\",\"importedQueryDefaults\",[\"^1>\",[]],\"enableTransformer\",false,\"showUpdateSetValueDynamicallyToggle\",true,\"overrideOrgCacheForUserCache\",false,\"bulkUpdatePrimaryKey\",\"\",\"runWhenPageLoads\",false,\"transformer\",\"return data\",\"events\",[\"^A\",[]],\"tableName\",\"\",\"queryTimeout\",\"120000\",\"workflowId\",null,\"requireConfirmation\",false,\"queryFailureConditions\",\"\",\"changesetIsObject\",false,\"enableCaching\",false,\"allowedGroups\",[\"^A\",[]],\"databaseUsernameOverride\",\"\",\"databaseRoleOverride\",\"\",\"shouldEnableBatchQuerying\",false,\"doNotThrowOnNoOp\",false,\"offlineQueryType\",\"None\",\"queryThrottleTime\",\"750\",\"updateSetValueDynamically\",false,\"notificationDuration\",\"\"]],\"^1?\",[\"^1>\",[]],\"^1@\",null,\"^1A\",null,\"^1B\",null,\"^1C\",null,\"^1D\",\"\",\"^7\",\"~m1745946161733\",\"^1E\",\"~m1748966044727\",\"^1F\",\"\",\"^1G\",null,\"^1H\",null,\"^1I\",null,\"^1J\",null]]],\"workflow_data\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"workflow_data\",\"^16\",null,\"^17\",null,\"^18\",\"datasource\",\"^19\",\"SqlQueryUnified\",\"^1:\",null,\"^1;\",\"01ebedd9-f35e-425f-9c3f-5429f9cfa4fe\",\"^1<\",\"retool_db\",\"^1=\",[\"^1>\",[\"queryRefreshTime\",\"\",\"allowedGroupIds\",[\"^A\",[]],\"streamResponse\",false,\"records\",\"\",\"lastReceivedFromResourceAt\",null,\"isFunction\",false,\"databasePasswordOverride\",\"\",\"functionParameters\",null,\"queryDisabledMessage\",\"\",\"servedFromCache\",false,\"offlineUserQueryInputs\",\"\",\"functionDescription\",null,\"successMessage\",\"\",\"queryDisabled\",\"\",\"playgroundQuerySaveId\",\"latest\",\"workflowParams\",null,\"resourceNameOverride\",\"\",\"runWhenModelUpdates\",false,\"workflowRunExecutionType\",\"sync\",\"showFailureToaster\",true,\"query\",\"select * from workflow_data where workflow_id = '{{ workflowContext.workflowId }}'\",\"playgroundQueryUuid\",\"\",\"playgroundQueryId\",null,\"error\",null,\"workflowRunBodyType\",\"raw\",\"privateParams\",[\"^A\",[]],\"queryRunOnSelectorUpdate\",false,\"runWhenPageLoadsDelay\",\"\",\"warningCodes\",[\"^A\",[]],\"data\",null,\"recordId\",\"\",\"importedQueryInputs\",[\"^1>\",[]],\"_additionalScope\",[\"^A\",[]],\"isImported\",false,\"showSuccessToaster\",true,\"dataArray\",[\"^A\",[]],\"cacheKeyTtl\",\"\",\"filterBy\",\"\",\"requestSentTimestamp\",null,\"databaseHostOverride\",\"\",\"metadata\",null,\"editorMode\",\"sql\",\"queryRunTime\",null,\"actionType\",\"\",\"changesetObject\",\"\",\"shouldUseLegacySql\",false,\"offlineOptimisticResponse\",null,\"errorTransformer\",\"return data.error\",\"finished\",null,\"databaseNameOverride\",\"\",\"confirmationMessage\",null,\"isFetching\",false,\"changeset\",\"\",\"rawData\",null,\"queryTriggerDelay\",\"0\",\"resourceTypeOverride\",null,\"watchedParams\",[\"^A\",[]],\"enableErrorTransformer\",false,\"databaseWarehouseOverride\",\"\",\"enableBulkUpdates\",false,\"showLatestVersionUpdatedWarning\",false,\"timestamp\",0,\"evalType\",\"script\",\"importedQueryDefaults\",[\"^1>\",[]],\"enableTransformer\",false,\"showUpdateSetValueDynamicallyToggle\",true,\"overrideOrgCacheForUserCache\",false,\"bulkUpdatePrimaryKey\",\"\",\"runWhenPageLoads\",false,\"transformer\",\"return data\",\"events\",[\"^A\",[]],\"tableName\",\"\",\"queryTimeout\",\"120000\",\"workflowId\",null,\"requireConfirmation\",false,\"queryFailureConditions\",\"\",\"changesetIsObject\",false,\"enableCaching\",false,\"allowedGroups\",[\"^A\",[]],\"databaseUsernameOverride\",\"\",\"databaseRoleOverride\",\"\",\"shouldEnableBatchQuerying\",false,\"doNotThrowOnNoOp\",false,\"offlineQueryType\",\"None\",\"queryThrottleTime\",\"750\",\"updateSetValueDynamically\",false,\"notificationDuration\",\"\"]],\"^1?\",null,\"^1@\",null,\"^1A\",null,\"^1B\",null,\"^1C\",null,\"^1D\",\"\",\"^7\",\"~m1748328504918\",\"^1E\",\"~m1753119263136\",\"^1F\",\"\",\"^1G\",null,\"^1H\",null,\"^1I\",null,\"^1J\",null]]],\"code1\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"code1\",\"^16\",null,\"^17\",null,\"^18\",\"datasource\",\"^19\",\"JavascriptQuery\",\"^1:\",null,\"^1;\",\"JavascriptQuery\",\"^1<\",null,\"^1=\",[\"^1>\",[\"queryRefreshTime\",\"\",\"allowedGroupIds\",[\"^A\",[]],\"streamResponse\",false,\"lastReceivedFromResourceAt\",null,\"isFunction\",false,\"functionParameters\",null,\"queryDisabledMessage\",\"\",\"servedFromCache\",false,\"offlineUserQueryInputs\",\"\",\"functionDescription\",null,\"successMessage\",\"\",\"queryDisabled\",\"\",\"playgroundQuerySaveId\",\"latest\",\"workflowParams\",null,\"resourceNameOverride\",\"\",\"runWhenModelUpdates\",false,\"workflowRunExecutionType\",\"sync\",\"showFailureToaster\",true,\"query\",\"const response = {\\n  workflowContext: workflowContext,\\n  startedAt:\\n    workflowContext.currentRun.startedAtEpochMs > 0\\n      ? new Date(workflowContext.currentRun.startedAtEpochMs).toISOString()\\n      : null,\\n  endedAt: new Date().toISOString(),\\n  workflowStatus: \\\"SUCCESS\\\",\\n  webshopUuid: startTrigger.data.webshopUuid,\\n  webshopHandle: startTrigger.data.webshopHandle,\\n  workflowDescription: workflow_data.data[0].workflow_description,\\n  workflowCount: new Set(workflow_data.data.map(item => item.workflow_id)).size\\n};\\n\\nreturn { body: response };\",\"playgroundQueryUuid\",\"\",\"playgroundQueryId\",null,\"error\",null,\"workflowRunBodyType\",\"raw\",\"privateParams\",[\"^A\",[]],\"queryRunOnSelectorUpdate\",false,\"runWhenPageLoadsDelay\",\"\",\"data\",null,\"importedQueryInputs\",[\"^1>\",[]],\"_additionalScope\",[\"^A\",[]],\"isImported\",false,\"showSuccessToaster\",true,\"cacheKeyTtl\",\"\",\"requestSentTimestamp\",null,\"metadata\",null,\"queryRunTime\",null,\"changesetObject\",\"\",\"offlineOptimisticResponse\",null,\"errorTransformer\",\"return data.error\",\"finished\",null,\"confirmationMessage\",null,\"isFetching\",false,\"changeset\",\"\",\"rawData\",null,\"queryTriggerDelay\",\"0\",\"resourceTypeOverride\",null,\"watchedParams\",[\"^A\",[]],\"enableErrorTransformer\",false,\"showLatestVersionUpdatedWarning\",false,\"timestamp\",0,\"evalType\",\"script\",\"importedQueryDefaults\",[\"^1>\",[]],\"enableTransformer\",false,\"showUpdateSetValueDynamicallyToggle\",true,\"overrideOrgCacheForUserCache\",false,\"runWhenPageLoads\",false,\"transformer\",\"return data\",\"events\",[\"^A\",[]],\"queryTimeout\",\"120000\",\"workflowId\",null,\"requireConfirmation\",false,\"queryFailureConditions\",\"\",\"changesetIsObject\",false,\"enableCaching\",false,\"allowedGroups\",[\"^A\",[]],\"offlineQueryType\",\"None\",\"queryThrottleTime\",\"750\",\"updateSetValueDynamically\",false,\"notificationDuration\",\"\"]],\"^1?\",null,\"^1@\",null,\"^1A\",null,\"^1B\",null,\"^1C\",null,\"^1D\",\"\",\"^7\",\"~m1748959291262\",\"^1E\",\"~m1748965868266\",\"^1F\",\"\",\"^1G\",null,\"^1H\",null,\"^1I\",null,\"^1J\",null]]],\"code2\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"code2\",\"^16\",null,\"^17\",null,\"^18\",\"datasource\",\"^19\",\"JavascriptQuery\",\"^1:\",null,\"^1;\",\"JavascriptQuery\",\"^1<\",null,\"^1=\",[\"^1>\",[\"queryRefreshTime\",\"\",\"allowedGroupIds\",[\"^A\",[]],\"streamResponse\",false,\"lastReceivedFromResourceAt\",null,\"isFunction\",false,\"functionParameters\",null,\"queryDisabledMessage\",\"\",\"servedFromCache\",false,\"offlineUserQueryInputs\",\"\",\"functionDescription\",null,\"successMessage\",\"\",\"queryDisabled\",\"\",\"playgroundQuerySaveId\",\"latest\",\"workflowParams\",null,\"resourceNameOverride\",\"\",\"runWhenModelUpdates\",false,\"workflowRunExecutionType\",\"sync\",\"showFailureToaster\",true,\"query\",\"const response = {\\n  workflowContext: workflowContext,\\n  startedAt:\\n    workflowContext.currentRun.startedAtEpochMs > 0\\n      ? new Date(workflowContext.currentRun.startedAtEpochMs).toISOString()\\n      : null,\\n  endedAt: new Date().toISOString(),\\n  workflowStatus: \\\"FAILURE\\\",\\n  webshopUuid: startTrigger.data.webshopUuid,\\n  webshopHandle: startTrigger.data.webshopHandle,\\n  workflowDescription: workflow_data.data[0].workflow_description,\\n  workflowCount: new Set(workflow_data.data.map(item => item.workflow_id)).size\\n};\\n\\nreturn { body: response };\",\"playgroundQueryUuid\",\"\",\"playgroundQueryId\",null,\"error\",null,\"workflowRunBodyType\",\"raw\",\"privateParams\",[\"^A\",[]],\"queryRunOnSelectorUpdate\",false,\"runWhenPageLoadsDelay\",\"\",\"data\",null,\"importedQueryInputs\",[\"^1>\",[]],\"_additionalScope\",[\"^A\",[]],\"isImported\",false,\"showSuccessToaster\",true,\"cacheKeyTtl\",\"\",\"requestSentTimestamp\",null,\"metadata\",null,\"queryRunTime\",null,\"changesetObject\",\"\",\"offlineOptimisticResponse\",null,\"errorTransformer\",\"return data.error\",\"finished\",null,\"confirmationMessage\",null,\"isFetching\",false,\"changeset\",\"\",\"rawData\",null,\"queryTriggerDelay\",\"0\",\"resourceTypeOverride\",null,\"watchedParams\",[\"^A\",[]],\"enableErrorTransformer\",false,\"showLatestVersionUpdatedWarning\",false,\"timestamp\",0,\"evalType\",\"script\",\"importedQueryDefaults\",[\"^1>\",[]],\"enableTransformer\",false,\"showUpdateSetValueDynamicallyToggle\",true,\"overrideOrgCacheForUserCache\",false,\"runWhenPageLoads\",false,\"transformer\",\"return data\",\"events\",[\"^A\",[]],\"queryTimeout\",\"120000\",\"workflowId\",null,\"requireConfirmation\",false,\"queryFailureConditions\",\"\",\"changesetIsObject\",false,\"enableCaching\",false,\"allowedGroups\",[\"^A\",[]],\"offlineQueryType\",\"None\",\"queryThrottleTime\",\"750\",\"updateSetValueDynamically\",false,\"notificationDuration\",\"\"]],\"^1?\",null,\"^1@\",null,\"^1A\",null,\"^1B\",null,\"^1C\",null,\"^1D\",\"\",\"^7\",\"~m1748959309151\",\"^1E\",\"~m1749706009025\",\"^1F\",\"\",\"^1G\",null,\"^1H\",null,\"^1I\",null,\"^1J\",null]]],\"get_optiply_data\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"get_optiply_data\",\"^16\",null,\"^17\",null,\"^18\",\"datasource\",\"^19\",\"SqlQueryUnified\",\"^1:\",null,\"^1;\",\"Optiply_ProductionDB\",\"^1<\",\"Optiply_Production\",\"^1=\",[\"^1>\",[\"queryRefreshTime\",\"\",\"allowedGroupIds\",[\"^A\",[]],\"streamResponse\",false,\"records\",\"\",\"lastReceivedFromResourceAt\",null,\"isFunction\",false,\"databasePasswordOverride\",\"\",\"functionParameters\",null,\"queryDisabledMessage\",\"\",\"servedFromCache\",false,\"offlineUserQueryInputs\",\"\",\"functionDescription\",null,\"successMessage\",\"\",\"queryDisabled\",\"\",\"playgroundQuerySaveId\",\"latest\",\"workflowParams\",null,\"resourceNameOverride\",\"\",\"runWhenModelUpdates\",false,\"workflowRunExecutionType\",\"sync\",\"showFailureToaster\",true,\"query\",\"SELECT\\n    sp.id,\\n    sp.sku,\\n    sp.free_stock,\\n    sp.cost_price\\nFROM\\n    supplier_products sp\\nWHERE\\n    sp.supplier_id = 768200\\n    AND sp.deleted_at IS NULL\\n    AND sp.status = 'enabled';\",\"playgroundQueryUuid\",\"\",\"playgroundQueryId\",null,\"error\",null,\"workflowRunBodyType\",\"raw\",\"privateParams\",[\"^A\",[]],\"queryRunOnSelectorUpdate\",false,\"runWhenPageLoadsDelay\",\"\",\"warningCodes\",[\"^A\",[]],\"data\",null,\"recordId\",\"\",\"importedQueryInputs\",[\"^1>\",[]],\"_additionalScope\",[\"^A\",[]],\"isImported\",false,\"showSuccessToaster\",true,\"dataArray\",[\"^A\",[]],\"cacheKeyTtl\",\"\",\"filterBy\",\"\",\"requestSentTimestamp\",null,\"databaseHostOverride\",\"\",\"metadata\",null,\"editorMode\",\"sql\",\"queryRunTime\",null,\"actionType\",\"\",\"changesetObject\",\"\",\"shouldUseLegacySql\",false,\"offlineOptimisticResponse\",null,\"errorTransformer\",\"return data.error\",\"finished\",null,\"databaseNameOverride\",\"\",\"confirmationMessage\",null,\"isFetching\",false,\"changeset\",\"\",\"rawData\",null,\"queryTriggerDelay\",\"0\",\"resourceTypeOverride\",null,\"watchedParams\",[\"^A\",[]],\"enableErrorTransformer\",false,\"databaseWarehouseOverride\",\"\",\"enableBulkUpdates\",false,\"showLatestVersionUpdatedWarning\",false,\"timestamp\",0,\"evalType\",\"script\",\"importedQueryDefaults\",[\"^1>\",[]],\"enableTransformer\",false,\"showUpdateSetValueDynamicallyToggle\",true,\"overrideOrgCacheForUserCache\",false,\"bulkUpdatePrimaryKey\",\"\",\"runWhenPageLoads\",false,\"transformer\",\"return data\",\"events\",[\"^A\",[]],\"tableName\",\"\",\"queryTimeout\",\"120000\",\"workflowId\",null,\"requireConfirmation\",false,\"queryFailureConditions\",\"\",\"changesetIsObject\",false,\"enableCaching\",false,\"allowedGroups\",[\"^A\",[]],\"databaseUsernameOverride\",\"\",\"databaseRoleOverride\",\"\",\"shouldEnableBatchQuerying\",false,\"doNotThrowOnNoOp\",false,\"offlineQueryType\",\"None\",\"queryThrottleTime\",\"750\",\"updateSetValueDynamically\",false,\"notificationDuration\",\"\"]],\"^1?\",null,\"^1@\",null,\"^1A\",null,\"^1B\",null,\"^1C\",null,\"^1D\",\"\",\"^7\",\"~m1751881743166\",\"^1E\",\"~m1772091389459\",\"^1F\",\"\",\"^1G\",null,\"^1H\",null,\"^1I\",null,\"^1J\",null]]],\"map_suppliers\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"map_suppliers\",\"^16\",null,\"^17\",null,\"^18\",\"datasource\",\"^19\",\"JavascriptQuery\",\"^1:\",null,\"^1;\",\"JavascriptQuery\",\"^1<\",null,\"^1=\",[\"^1>\",[\"queryRefreshTime\",\"\",\"allowedGroupIds\",[\"^A\",[]],\"streamResponse\",false,\"lastReceivedFromResourceAt\",null,\"isFunction\",false,\"functionParameters\",null,\"queryDisabledMessage\",\"\",\"servedFromCache\",false,\"offlineUserQueryInputs\",\"\",\"functionDescription\",null,\"successMessage\",\"\",\"queryDisabled\",\"\",\"playgroundQuerySaveId\",\"latest\",\"workflowParams\",null,\"resourceNameOverride\",\"\",\"runWhenModelUpdates\",false,\"workflowRunExecutionType\",\"sync\",\"showFailureToaster\",true,\"query\",\"// Normalize: ensure we always have arrays (Retool may wrap Python/query results)\\nconst toArray = (x) => Array.isArray(x) ? x : (x && x.data && Array.isArray(x.data) ? x.data : (x && x.data ? [x.data] : []));\\nconst supplierList = toArray(craft_ftp && craft_ftp.data);\\nconst priceList = toArray(craft_price && craft_price.data);\\nconst optiplyArray = toArray(get_optiply_data && get_optiply_data.data);\\n\\n// Normalize SKU for matching (FTP often zero-padded \\\"000450\\\", Optiply may have \\\"450\\\")\\nconst norm = (s) => (s == null || s === '') ? '' : String(s).trim().replace(/^0+/, '') || '0';\\n\\n// 1. Optiply lookup by normalized SKU (must include cost_price for comparison)\\nconst optiplyLookup = {};\\noptiplyArray.forEach(item => {\\n  if (item.sku != null) {\\n    const k = norm(item.sku);\\n    optiplyLookup[k] = item;\\n  }\\n});\\n\\n// 2. Stock lookup from FTP: key by normalized SKU (support both 'SKU'/'Stock' and 'sku'/'stock')\\nconst stockBySku = {};\\nsupplierList.forEach(item => {\\n  const sku = norm(item['SKU'] ?? item['sku'] ?? '');\\n  const stock = item['Stock'] ?? item['stock'];\\n  if (sku) stockBySku[sku] = stock;\\n});\\n\\n// 3. Price lookup from FTP: key by normalized SKU\\nconst priceBySku = {};\\npriceList.forEach(p => {\\n  const sku = norm(p && (p.SKU ?? p.sku ?? ''));\\n  const price = p && (p.UnitPrice ?? p.unit_price);\\n  if (sku) priceBySku[sku] = price;\\n});\\n\\n// 4. All SKUs that appear in either feed (normalized)\\nconst allSkus = new Set([\\n  ...Object.keys(stockBySku),\\n  ...Object.keys(priceBySku)\\n]);\\n\\n// 5. Build updates: one row per product that needs a stock and/or price update\\nconst updates = [];\\nallSkus.forEach(normSku => {\\n  const dbItem = optiplyLookup[normSku];\\n  if (!dbItem) return;\\n\\n  const rawStock = stockBySku[normSku];\\n  const rawPrice = priceBySku[normSku];\\n  const parsedStock = rawStock != null && String(rawStock).trim() !== '' ? parseInt(rawStock, 10) : NaN;\\n  const parsedPrice = rawPrice != null && String(rawPrice).trim() !== '' ? parseFloat(rawPrice) : NaN;\\n  const newStock = Number.isNaN(parsedStock) ? null : parsedStock;\\n  const newPrice = Number.isNaN(parsedPrice) ? null : parsedPrice;\\n\\n  const currentStock = dbItem.free_stock;\\n  const currentPrice = dbItem.cost_price != null ? parseFloat(dbItem.cost_price) : null;\\n  const needStockUpdate = newStock != null && (currentStock == null || parseInt(currentStock, 10) !== newStock);\\n  const needPriceUpdate = newPrice != null && (currentPrice == null || Math.abs(currentPrice - newPrice) > 1e-9);\\n\\n  if (needStockUpdate || needPriceUpdate) {\\n    updates.push({\\n      id: dbItem.id,\\n      free_stock: needStockUpdate ? newStock : null,\\n      cost_price: needPriceUpdate ? newPrice : null\\n    });\\n  }\\n});\\n\\nreturn updates;\",\"playgroundQueryUuid\",\"\",\"playgroundQueryId\",null,\"error\",null,\"workflowRunBodyType\",\"raw\",\"privateParams\",[\"^A\",[]],\"queryRunOnSelectorUpdate\",false,\"runWhenPageLoadsDelay\",\"\",\"data\",null,\"importedQueryInputs\",[\"^1>\",[]],\"_additionalScope\",[\"^A\",[]],\"isImported\",false,\"showSuccessToaster\",true,\"cacheKeyTtl\",\"\",\"requestSentTimestamp\",null,\"metadata\",null,\"queryRunTime\",null,\"changesetObject\",\"\",\"offlineOptimisticResponse\",null,\"errorTransformer\",\"return data.error\",\"finished\",null,\"confirmationMessage\",null,\"isFetching\",false,\"changeset\",\"\",\"rawData\",null,\"queryTriggerDelay\",\"0\",\"resourceTypeOverride\",null,\"watchedParams\",[\"^A\",[]],\"enableErrorTransformer\",false,\"showLatestVersionUpdatedWarning\",false,\"timestamp\",0,\"evalType\",\"script\",\"importedQueryDefaults\",[\"^1>\",[]],\"enableTransformer\",false,\"showUpdateSetValueDynamicallyToggle\",true,\"overrideOrgCacheForUserCache\",false,\"runWhenPageLoads\",false,\"transformer\",\"return data\",\"events\",[\"^A\",[]],\"queryTimeout\",\"120000\",\"workflowId\",null,\"requireConfirmation\",false,\"queryFailureConditions\",\"\",\"changesetIsObject\",false,\"enableCaching\",false,\"allowedGroups\",[\"^A\",[]],\"offlineQueryType\",\"None\",\"queryThrottleTime\",\"750\",\"updateSetValueDynamically\",false,\"notificationDuration\",\"\"]],\"^1?\",null,\"^1@\",null,\"^1A\",null,\"^1B\",null,\"^1C\",null,\"^1D\",\"\",\"^7\",\"~m1751882132310\",\"^1E\",\"~m1772091988512\",\"^1F\",\"\",\"^1G\",null,\"^1H\",null,\"^1I\",null,\"^1J\",null]]],\"patch_check\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"patch_check\",\"^16\",null,\"^17\",null,\"^18\",\"datasource\",\"^19\",\"JavascriptQuery\",\"^1:\",null,\"^1;\",\"JavascriptQuery\",\"^1<\",null,\"^1=\",[\"^1>\",[\"queryRefreshTime\",\"\",\"allowedGroupIds\",[\"^A\",[]],\"streamResponse\",false,\"lastReceivedFromResourceAt\",null,\"isFunction\",false,\"functionParameters\",null,\"queryDisabledMessage\",\"\",\"servedFromCache\",false,\"offlineUserQueryInputs\",\"\",\"functionDescription\",null,\"successMessage\",\"\",\"queryDisabled\",\"\",\"playgroundQuerySaveId\",\"latest\",\"workflowParams\",null,\"resourceNameOverride\",\"\",\"runWhenModelUpdates\",false,\"workflowRunExecutionType\",\"sync\",\"showFailureToaster\",true,\"query\",\"if (map_suppliers.data != 0) {\\n  executePathAtMostOnce('0')\\n}\\nelse { executePathAtMostOnce('1') }\",\"playgroundQueryUuid\",\"\",\"playgroundQueryId\",null,\"error\",null,\"workflowRunBodyType\",\"raw\",\"privateParams\",[\"^A\",[]],\"queryRunOnSelectorUpdate\",false,\"runWhenPageLoadsDelay\",\"\",\"data\",null,\"importedQueryInputs\",[\"^1>\",[]],\"_additionalScope\",[\"^A\",[]],\"isImported\",false,\"showSuccessToaster\",true,\"cacheKeyTtl\",\"\",\"requestSentTimestamp\",null,\"metadata\",null,\"editorMode\",\"sql\",\"queryRunTime\",null,\"changesetObject\",\"\",\"offlineOptimisticResponse\",null,\"errorTransformer\",\"return data.error\",\"finished\",null,\"confirmationMessage\",null,\"isFetching\",false,\"changeset\",\"\",\"rawData\",null,\"queryTriggerDelay\",\"0\",\"resourceTypeOverride\",null,\"watchedParams\",[\"^A\",[]],\"enableErrorTransformer\",false,\"showLatestVersionUpdatedWarning\",false,\"timestamp\",0,\"evalType\",\"script\",\"importedQueryDefaults\",[\"^1>\",[]],\"enableTransformer\",false,\"showUpdateSetValueDynamicallyToggle\",true,\"overrideOrgCacheForUserCache\",false,\"runWhenPageLoads\",false,\"transformer\",\"return data\",\"events\",[\"^A\",[]],\"queryTimeout\",\"120000\",\"workflowId\",null,\"requireConfirmation\",false,\"queryFailureConditions\",\"\",\"changesetIsObject\",false,\"enableCaching\",false,\"allowedGroups\",[\"^A\",[]],\"offlineQueryType\",\"None\",\"queryThrottleTime\",\"750\",\"updateSetValueDynamically\",false,\"notificationDuration\",\"\"]],\"^1?\",null,\"^1@\",null,\"^1A\",null,\"^1B\",null,\"^1C\",null,\"^1D\",\"\",\"^7\",\"~m1751898482376\",\"^1E\",\"~m1753118999966\",\"^1F\",\"\",\"^1G\",null,\"^1H\",null,\"^1I\",null,\"^1J\",null]]],\"map_data\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"map_data\",\"^16\",null,\"^17\",null,\"^18\",\"datasource\",\"^19\",\"JavascriptQuery\",\"^1:\",null,\"^1;\",\"JavascriptQuery\",\"^1<\",null,\"^1=\",[\"^1>\",[\"queryRefreshTime\",\"\",\"allowedGroupIds\",[\"^A\",[]],\"streamResponse\",false,\"lastReceivedFromResourceAt\",null,\"isFunction\",false,\"functionParameters\",null,\"queryDisabledMessage\",\"\",\"servedFromCache\",false,\"offlineUserQueryInputs\",\"\",\"functionDescription\",null,\"successMessage\",\"\",\"queryDisabled\",\"\",\"playgroundQuerySaveId\",\"latest\",\"workflowParams\",null,\"resourceNameOverride\",\"\",\"runWhenModelUpdates\",false,\"workflowRunExecutionType\",\"sync\",\"showFailureToaster\",true,\"query\",\"const channableData = get_channable_data.data;\\nif (!channableData || !Array.isArray(channableData)) {\\n  return {};\\n}\\n// Create a Map object for instant lookups inside the loop.\\nconst channableMap = new Map(\\n  channableData.map(product => [product.id, product])\\n);\\nreturn channableMap;\",\"playgroundQueryUuid\",\"\",\"playgroundQueryId\",null,\"error\",null,\"workflowRunBodyType\",\"raw\",\"privateParams\",[\"^A\",[]],\"queryRunOnSelectorUpdate\",false,\"runWhenPageLoadsDelay\",\"\",\"data\",null,\"importedQueryInputs\",[\"^1>\",[]],\"_additionalScope\",[\"^A\",[]],\"isImported\",false,\"showSuccessToaster\",true,\"cacheKeyTtl\",\"\",\"requestSentTimestamp\",null,\"metadata\",null,\"queryRunTime\",null,\"changesetObject\",\"\",\"offlineOptimisticResponse\",null,\"errorTransformer\",\"return data.error\",\"finished\",null,\"confirmationMessage\",null,\"isFetching\",false,\"changeset\",\"\",\"rawData\",null,\"queryTriggerDelay\",\"0\",\"resourceTypeOverride\",null,\"watchedParams\",[\"^A\",[]],\"enableErrorTransformer\",false,\"showLatestVersionUpdatedWarning\",false,\"timestamp\",0,\"evalType\",\"script\",\"importedQueryDefaults\",[\"^1>\",[]],\"enableTransformer\",false,\"showUpdateSetValueDynamicallyToggle\",true,\"overrideOrgCacheForUserCache\",false,\"runWhenPageLoads\",false,\"transformer\",\"return data\",\"events\",[\"^A\",[]],\"queryTimeout\",\"10000\",\"workflowId\",null,\"requireConfirmation\",false,\"queryFailureConditions\",\"\",\"changesetIsObject\",false,\"enableCaching\",false,\"allowedGroups\",[\"^A\",[]],\"offlineQueryType\",\"None\",\"queryThrottleTime\",\"750\",\"updateSetValueDynamically\",false,\"notificationDuration\",\"\"]],\"^1?\",null,\"^1@\",null,\"^1A\",null,\"^1B\",null,\"^1C\",null,\"^1D\",\"\",\"^7\",\"~m1753440475184\",\"^1E\",\"~m1753440553187\",\"^1F\",\"\",\"^1G\",null,\"^1H\",null,\"^1I\",null,\"^1J\",null]]],\"craft_ftp\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"craft_ftp\",\"^16\",null,\"^17\",null,\"^18\",\"datasource\",\"^19\",\"PythonQuery\",\"^1:\",null,\"^1;\",\"PythonQuery\",\"^1<\",null,\"^1=\",[\"^1>\",[\"queryRefreshTime\",\"\",\"allowedGroupIds\",[\"^A\",[]],\"streamResponse\",false,\"lastReceivedFromResourceAt\",null,\"isFunction\",false,\"functionParameters\",null,\"queryDisabledMessage\",\"\",\"servedFromCache\",false,\"offlineUserQueryInputs\",\"\",\"functionDescription\",null,\"successMessage\",\"\",\"queryDisabled\",\"\",\"playgroundQuerySaveId\",\"latest\",\"workflowParams\",null,\"resourceNameOverride\",\"\",\"runWhenModelUpdates\",false,\"workflowRunExecutionType\",\"sync\",\"showFailureToaster\",true,\"query\",\"from ftplib import FTP\\nimport io\\nimport xml.etree.ElementTree as ET\\n\\n# 1. Connect and Navigate\\ntry:\\n    ftp = FTP('ftp.quantore.com')\\n    ftp.login(user='ALLCOE', passwd='FP=32Ejbh')\\n    ftp.cwd('StockV4')\\nexcept Exception as e:\\n    print(f\\\"Connection Error: {e}\\\")\\n    return []\\n\\n# 2. Download STOCK.XML\\ndownload_stream = io.BytesIO()\\ntry:\\n    ftp.retrbinary('RETR STOCK.XML', download_stream.write)\\nexcept Exception as e:\\n    print(f\\\"Download Error: {e}\\\")\\n    ftp.quit()\\n    return []\\n\\nftp.quit()\\n\\n# 3. Parse XML\\ndownload_stream.seek(0)\\ncontent = download_stream.getvalue().decode('utf-8-sig', errors='ignore')\\n\\ntry:\\n    root = ET.fromstring(content)\\nexcept ET.ParseError as e:\\n    print(f\\\"XML Parse Error: {e}\\\")\\n    return []\\n\\nclean_data = []\\n\\n# 4. Extract Data (ProductCodeSupplier = product id, AvailableStock = stock qty)\\nfor stock in root.findall('Stock'):\\n    p_code = stock.find('ProductCodeSupplier')\\n    p_stock = stock.find('AvailableStock')\\n\\n    if p_code is not None and p_stock is not None:\\n        clean_data.append({\\n            \\\"SKU\\\": p_code.text.strip() if p_code.text else \\\"\\\",\\n            \\\"Stock\\\": p_stock.text\\n        })\\n\\nreturn clean_data\",\"playgroundQueryUuid\",\"\",\"playgroundQueryId\",null,\"error\",null,\"workflowRunBodyType\",\"raw\",\"privateParams\",[\"^A\",[]],\"queryRunOnSelectorUpdate\",false,\"runWhenPageLoadsDelay\",\"\",\"data\",null,\"importedQueryInputs\",[\"^1>\",[]],\"isImported\",false,\"showSuccessToaster\",true,\"cacheKeyTtl\",\"\",\"requestSentTimestamp\",null,\"metadata\",null,\"queryRunTime\",null,\"changesetObject\",\"\",\"offlineOptimisticResponse\",null,\"errorTransformer\",\"return data.error\",\"finished\",null,\"confirmationMessage\",null,\"isFetching\",false,\"changeset\",\"\",\"rawData\",null,\"queryTriggerDelay\",\"0\",\"resourceTypeOverride\",null,\"watchedParams\",[\"^A\",[]],\"enableErrorTransformer\",false,\"showLatestVersionUpdatedWarning\",false,\"timestamp\",0,\"evalType\",\"script\",\"importedQueryDefaults\",[\"^1>\",[]],\"enableTransformer\",false,\"showUpdateSetValueDynamicallyToggle\",true,\"overrideOrgCacheForUserCache\",false,\"runWhenPageLoads\",false,\"transformer\",\"return data\",\"events\",[\"^A\",[]],\"queryTimeout\",\"120000\",\"workflowId\",null,\"requireConfirmation\",false,\"queryFailureConditions\",\"\",\"changesetIsObject\",false,\"enableCaching\",false,\"allowedGroups\",[\"^A\",[]],\"offlineQueryType\",\"None\",\"queryThrottleTime\",\"750\",\"updateSetValueDynamically\",false,\"notificationDuration\",\"\"]],\"^1?\",null,\"^1@\",null,\"^1A\",null,\"^1B\",null,\"^1C\",null,\"^1D\",\"\",\"^7\",\"~m1765271985369\",\"^1E\",\"~m1772091728791\",\"^1F\",\"\",\"^1G\",null,\"^1H\",null,\"^1I\",null,\"^1J\",null]]],\"craft_price\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"craft_price\",\"^16\",null,\"^17\",null,\"^18\",\"datasource\",\"^19\",\"PythonQuery\",\"^1:\",null,\"^1;\",\"PythonQuery\",\"^1<\",null,\"^1=\",[\"^1>\",[\"queryRefreshTime\",\"\",\"allowedGroupIds\",[\"^A\",[]],\"streamResponse\",false,\"lastReceivedFromResourceAt\",null,\"isFunction\",false,\"functionParameters\",null,\"queryDisabledMessage\",\"\",\"servedFromCache\",false,\"offlineUserQueryInputs\",\"\",\"functionDescription\",null,\"successMessage\",\"\",\"queryDisabled\",\"\",\"playgroundQuerySaveId\",\"latest\",\"workflowParams\",null,\"resourceNameOverride\",\"\",\"runWhenModelUpdates\",false,\"workflowRunExecutionType\",\"sync\",\"showFailureToaster\",true,\"query\",\"from ftplib import FTP\\nimport io\\nimport xml.etree.ElementTree as ET\\n\\ntry:\\n    ftp = FTP('ftp.quantore.com')\\n    ftp.login(user='ALLCOE', passwd='FP=32Ejbh')\\n    ftp.cwd('Price')\\nexcept Exception as e:\\n    print(f\\\"Connection Error: {e}\\\")\\n    return []\\n\\ndownload_stream = io.BytesIO()\\ntry:\\n    ftp.retrbinary('RETR PRICE.XML', download_stream.write)\\nexcept Exception as e:\\n    print(f\\\"Download Error: {e}\\\")\\n    ftp.quit()\\n    return []\\n\\nftp.quit()\\n\\ndownload_stream.seek(0)\\ncontent = download_stream.getvalue().decode('utf-8-sig', errors='ignore')\\n\\ntry:\\n    root = ET.fromstring(content)\\nexcept ET.ParseError as e:\\n    print(f\\\"XML Parse Error: {e}\\\")\\n    return []\\n\\nclean_data = []\\nfor price in root.findall('Price'):\\n    p_code = price.find('ProductCodeSupplier')\\n    unit_price = price.find('UnitPrice')\\n    if p_code is not None and unit_price is not None and unit_price.text:\\n        clean_data.append({\\n            \\\"SKU\\\": (p_code.text or \\\"\\\").strip(),\\n            \\\"UnitPrice\\\": unit_price.text.strip()\\n        })\\n\\nreturn clean_data\",\"playgroundQueryUuid\",\"\",\"playgroundQueryId\",null,\"error\",null,\"workflowRunBodyType\",\"raw\",\"privateParams\",[\"^A\",[]],\"queryRunOnSelectorUpdate\",false,\"runWhenPageLoadsDelay\",\"\",\"data\",null,\"importedQueryInputs\",[\"^1>\",[]],\"isImported\",false,\"showSuccessToaster\",true,\"cacheKeyTtl\",\"\",\"requestSentTimestamp\",null,\"metadata\",null,\"queryRunTime\",null,\"changesetObject\",\"\",\"offlineOptimisticResponse\",null,\"errorTransformer\",\"return data.error\",\"finished\",null,\"confirmationMessage\",null,\"isFetching\",false,\"changeset\",\"\",\"rawData\",null,\"queryTriggerDelay\",\"0\",\"resourceTypeOverride\",null,\"watchedParams\",[\"^A\",[]],\"enableErrorTransformer\",false,\"showLatestVersionUpdatedWarning\",false,\"timestamp\",0,\"evalType\",\"script\",\"importedQueryDefaults\",[\"^1>\",[]],\"enableTransformer\",false,\"showUpdateSetValueDynamicallyToggle\",true,\"overrideOrgCacheForUserCache\",false,\"runWhenPageLoads\",false,\"transformer\",\"return data\",\"events\",[\"^A\",[]],\"queryTimeout\",\"120000\",\"workflowId\",null,\"requireConfirmation\",false,\"queryFailureConditions\",\"\",\"changesetIsObject\",false,\"enableCaching\",false,\"allowedGroups\",[\"^A\",[]],\"offlineQueryType\",\"None\",\"queryThrottleTime\",\"750\",\"updateSetValueDynamically\",false,\"notificationDuration\",\"\"]],\"^1?\",null,\"^1@\",null,\"^1A\",null,\"^1B\",null,\"^1C\",null,\"^1D\",\"\",\"^7\",\"~m1772087164710\",\"^1E\",\"~m1772091716315\",\"^1F\",\"\",\"^1G\",null,\"^1H\",null,\"^1I\",null,\"^1J\",null]]],\"write_cost_and_stock\",[\"^0\",[\"^ \",\"n\",\"pluginTemplate\",\"v\",[\"^ \",\"id\",\"write_cost_and_stock\",\"^16\",null,\"^17\",null,\"^18\",\"datasource\",\"^19\",\"SqlQueryUnified\",\"^1:\",null,\"^1;\",\"Optiply_ProductionDB\",\"^1<\",\"Optiply_Production\",\"^1=\",[\"^1>\",[\"queryRefreshTime\",\"\",\"allowedGroupIds\",[\"^A\",[]],\"streamResponse\",false,\"records\",\"\",\"lastReceivedFromResourceAt\",null,\"isFunction\",false,\"databasePasswordOverride\",\"\",\"functionParameters\",null,\"queryDisabledMessage\",\"\",\"servedFromCache\",false,\"offlineUserQueryInputs\",\"\",\"functionDescription\",null,\"successMessage\",\"\",\"queryDisabled\",\"\",\"playgroundQuerySaveId\",\"latest\",\"workflowParams\",null,\"resourceNameOverride\",\"\",\"runWhenModelUpdates\",false,\"workflowRunExecutionType\",\"sync\",\"showFailureToaster\",true,\"query\",\"UPDATE supplier_products AS sp\\nSET\\n  free_stock   = CASE WHEN update_data.free_stock IS NOT NULL THEN update_data.free_stock ELSE sp.free_stock END,\\n  cost_price   = CASE WHEN update_data.cost_price IS NOT NULL THEN update_data.cost_price ELSE sp.cost_price END,\\n  updated_at   = NOW()\\nFROM jsonb_to_recordset(\\n  {{ JSON.stringify(map_suppliers.data) }}::jsonb\\n) AS update_data(id int, free_stock int, cost_price numeric)\\nWHERE sp.id = update_data.id;\",\"playgroundQueryUuid\",\"\",\"playgroundQueryId\",null,\"error\",null,\"workflowRunBodyType\",\"raw\",\"privateParams\",[\"^A\",[]],\"queryRunOnSelectorUpdate\",false,\"runWhenPageLoadsDelay\",\"\",\"warningCodes\",[\"^A\",[]],\"data\",null,\"recordId\",\"\",\"importedQueryInputs\",[\"^1>\",[]],\"_additionalScope\",[\"^A\",[]],\"isImported\",false,\"showSuccessToaster\",true,\"dataArray\",[\"^A\",[]],\"cacheKeyTtl\",\"\",\"filterBy\",\"\",\"requestSentTimestamp\",null,\"databaseHostOverride\",\"\",\"metadata\",null,\"editorMode\",\"sql\",\"queryRunTime\",null,\"actionType\",\"\",\"changesetObject\",\"\",\"shouldUseLegacySql\",false,\"offlineOptimisticResponse\",null,\"errorTransformer\",\"return data.error\",\"finished\",null,\"databaseNameOverride\",\"\",\"confirmationMessage\",null,\"isFetching\",false,\"changeset\",\"\",\"rawData\",null,\"queryTriggerDelay\",\"0\",\"resourceTypeOverride\",null,\"watchedParams\",[\"^A\",[]],\"enableErrorTransformer\",false,\"databaseWarehouseOverride\",\"\",\"enableBulkUpdates\",false,\"showLatestVersionUpdatedWarning\",false,\"timestamp\",0,\"evalType\",\"script\",\"importedQueryDefaults\",[\"^1>\",[]],\"enableTransformer\",false,\"showUpdateSetValueDynamicallyToggle\",true,\"overrideOrgCacheForUserCache\",false,\"bulkUpdatePrimaryKey\",\"\",\"runWhenPageLoads\",false,\"transformer\",\"return data\",\"events\",[\"^A\",[]],\"tableName\",\"\",\"queryTimeout\",\"10000\",\"workflowId\",null,\"requireConfirmation\",false,\"queryFailureConditions\",\"\",\"changesetIsObject\",false,\"enableCaching\",false,\"allowedGroups\",[\"^A\",[]],\"databaseUsernameOverride\",\"\",\"databaseRoleOverride\",\"\",\"shouldEnableBatchQuerying\",false,\"doNotThrowOnNoOp\",false,\"offlineQueryType\",\"None\",\"queryThrottleTime\",\"750\",\"updateSetValueDynamically\",false,\"notificationDuration\",\"\"]],\"^1?\",null,\"^1@\",null,\"^1A\",null,\"^1B\",null,\"^1C\",null,\"^1D\",\"\",\"^7\",\"~m1772092008237\",\"^1E\",\"~m1772092024008\",\"^1F\",\"\",\"^1G\",null,\"^1H\",null,\"^1I\",null,\"^1J\",null]]]]],\"preloadedAppJavaScript\",null,\"preloadedAppJSLinks\",[],\"queryStatusVisibility\",false,\"responsiveLayoutDisabled\",false,\"rootScreen\",null,\"savePlatform\",\"web\",\"shortlink\",null,\"testEntities\",[],\"tests\",[],\"urlFragmentDefinitions\",[\"^A\",[]],\"version\",\"3.347.0\",\"serializedLayout\",null,\"agentEvals\",[\"^ \"]]]]","triggerWebhooks":[{"name":"startTrigger","uuid":"startTrigger","headers":"{}","inputSchema":{"properties":[]},"useHeaderApiKey":false,"exampleInputJSON":"{\n  \"webshopHandle\": 'alleeninkt',\n  \"webshopId\": 1346,\n  \"webshopUuid\": 'ec100d9c-c24d-432b-8393-251cbeb2633f'\n}","examplePathParams":""}],"customLibraries":[{"version":"3.4.0","language":"javascript","codeString":"/* Edit library variable below */\n\nconst uuid = require('uuid')\n\n/* Add destructured imports from library below\neg. const { pow, log } = require(\"mathjs\") */\n","libraryName":"uuid"},{"version":"4.17.21","language":"javascript","codeString":"/* Edit library variable below */\n\nconst _ = require('lodash')\n\n/* Add destructured imports from library below\neg. const { pow, log } = require(\"mathjs\") */\n","libraryName":"lodash"},{"version":"2.1.0","language":"javascript","codeString":"/* Edit library variable below */\n\nconst numbro = require('numbro')\n\n/* Add destructured imports from library below\neg. const { pow, log } = require(\"mathjs\") */\n","libraryName":"numbro"},{"version":"0.6.2","language":"javascript","codeString":"","libraryName":"xml2js"},{"version":"5.3.2","language":"javascript","codeString":"/* Edit library variable below */\n\nconst Papa = require('papaparse')\n\n/* Add destructured imports from library below\neg. const { pow, log } = require(\"mathjs\") */\n","libraryName":"papaparse"},{"version":"0.5.23","language":"javascript","codeString":"/* Edit library variable below */\n\nconst moment = require('moment-timezone')\n\n/* Add destructured imports from library below\neg. const { pow, log } = require(\"mathjs\") */\n","libraryName":"moment-timezone"}],"createdBy":323630,"protected":false,"setupScripts":{"python":{"codeString":""},"javascript":{"codeString":"// lodash\n/* Edit library variable below */\n\nconst _ = require('lodash')\n\n/* Add destructured imports from library below\neg. const { pow, log } = require(\"mathjs\") */\n\n// numbro\n/* Edit library variable below */\n\nconst numbro = require('numbro')\n\n/* Add destructured imports from library below\neg. const { pow, log } = require(\"mathjs\") */\n\n// papaparse\n/* Edit library variable below */\n\nconst Papa = require('papaparse')\n\n/* Add destructured imports from library below\neg. const { pow, log } = require(\"mathjs\") */\n\n// moment-timezone\n/* Edit library variable below */\n\nconst moment = require('moment-timezone')\n\n/* Add destructured imports from library below\neg. const { pow, log } = require(\"mathjs\") */\n\n// uuid\n/* Edit library variable below */\n\nconst uuid = require('uuid')\n\n/* Add destructured imports from library below\neg. const { pow, log } = require(\"mathjs\") */\n"}},"subflows":[],"type":"workflow","iconName":null,"iconColor":null,"private":false,"hasProtectedTriggers":false,"protectedTriggers":[],"readme":null,"javascriptLanguageConfiguration":{"name":"workflow_javascript_41d9e662-d1b2-41cb-8689-f7a710de6818","description":null,"libraries":{"uuid":{"specVersion":"3.4.0","actualVersion":""},"lodash":{"specVersion":"4.17.21","actualVersion":""},"numbro":{"specVersion":"2.1.0","actualVersion":""},"xml2js":{"specVersion":"0.6.2","actualVersion":""},"papaparse":{"specVersion":"5.3.2","actualVersion":""},"moment-timezone":{"specVersion":"0.5.23","actualVersion":""}},"librariesFormat":"package.json","language":"javascript"}}